# APP
FROM rust:alpine 
RUN apk update
RUN apk add nodejs npm  build-base openssl-dev clang curl nginx entr

WORKDIR '/shared-libs'
COPY shared-libs .
WORKDIR '/shared-libs/wasm'
RUN npm ci
RUN npm run build 
WORKDIR '/shared-libs/crypto'
RUN npm ci
WORKDIR '/shared-libs/config-generators'
RUN npm ci

# build the app
WORKDIR '/app'
COPY Interface/docker/wait-for.sh wait-for.sh
RUN chmod +x wait-for.sh
COPY Interface/package.json  .
COPY Interface/package-lock.json .
RUN npm ci

COPY Interface/src src 
COPY Interface/babel.config.js .
COPY Interface/vue.config.js .
COPY Interface/public public
COPY Interface/.env .
RUN npm run build


COPY Interface/tests tests
COPY Interface/nightwatch.conf.js .
COPY Interface/jest.config.js jest.config.js
COPY Interface/docker/nginx/test.conf /etc/nginx/nginx.conf

RUN mkdir -p /run/nginx

CMD ["nginx", "-g", "daemon off;"]